<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Create Invoice</title>
<style>
  :root{--bg:#0b0b0d;--muted:#b8b8c4}
  body{margin:0;min-height:100vh;display:grid;place-items:center;background:var(--bg);color:#fff;font-family:system-ui,Segoe UI,Arial}
  .wrap{width:min(780px,94vw);padding:28px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,.04),transparent);box-shadow:0 10px 30px rgba(0,0,0,.5)}
  h1{margin:0 0 10px}
  label{display:block;margin-top:12px;color:var(--muted);font-size:13px}
  input,select,textarea{width:100%;margin-top:6px;padding:11px 12px;border-radius:10px;border:1px solid #222;background:#070708;color:#fff}
  .row{display:flex;gap:12px}
  .row>*{flex:1}
  button{margin-top:16px;padding:12px 16px;border:0;border-radius:10px;background:#fff;color:#000;font-weight:700;cursor:pointer}
  .muted{color:var(--muted);font-size:13px}
  .out{margin-top:14px;word-break:break-all}
  .hidden{display:none}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Create invoice link</h1>
    <p class="muted">This is fully static. Link encodes the details and opens on your domain.</p>

    <div class="row">
      <div>
        <label>Invoice ID (optional)</label>
        <input id="id" placeholder="INV-2025-001"/>
      </div>
      <div>
        <label>Username (customer display)</label>
        <input id="user" placeholder="client_username" />
      </div>
    </div>

    <label>Notes (optional — payment instructions show on final page)</label>
    <input id="notes" placeholder="e.g., Bank transfer details / UPI remark / LTC memo"/>

    <label>Payment Method</label>
    <select id="method">
      <option value="upi">UPI</option>
      <option value="ltc">LTC (Litecoin)</option>
    </select>

    <div id="upiBox">
      <div class="row">
        <div>
          <label>Amount (INR)</label>
          <input id="amt_inr" type="number" min="1" step="1" placeholder="1999"/>
        </div>
        <div>
          <label>UPI ID (receiver)</label>
          <input id="upi" placeholder="name@upi"/>
        </div>
      </div>
    </div>

    <div id="ltcBox" class="hidden">
      <div class="row">
        <div>
          <label>Amount (USD) — display only</label>
          <input id="amt_usd" type="number" min="0.01" step="0.01" placeholder="49.99"/>
        </div>
        <div>
          <label>Amount (LTC) — for QR</label>
          <input id="amt_ltc" type="number" min="0.00000001" step="0.00000001" placeholder="0.12345678"/>
        </div>
      </div>
      <label>LTC Address (receiver)</label>
      <input id="ltc" placeholder="ltc1q... or L..."/>
    </div>

    <button id="gen">Generate Link</button>
    <div id="out" class="out"></div>
    <p class="muted"><a href="index.html" style="color:#fff;text-decoration:underline">Back to home</a></p>
  </div>

<script>
/* === LZ-String (compressToEncodedURIComponent / decompressFromEncodedURIComponent) ===
   Source: https://github.com/pieroxy/lz-string (MIT)
   Minified for brevity. */
!function(r){function t(r,t){if(!o[r]){o[r]={};for(var n=0;n<r.length;n++)o[r][r.charAt(n)]=n}return o[r][t]}function n(r,t){return e(r,t)}function e(r,t){if(null==r)return"";var n,e,i,o,u,a,s,c,f,l={},h={},p="";for(i=0;i<r.length;i+=1)if(p=r.charAt(i),Object.prototype.hasOwnProperty.call(l,p)||(l[p]=c++,h[p]=c-1),n=o+p,Object.prototype.hasOwnProperty.call(l,n))o=n;else{if(e+=a(String.fromCharCode(h[o])),l[c]=n,h[c]=c,c+=1,o=String(p),--t==0){t=2;for(var v=0;v<c;v+=1)l[String.fromCharCode(v)]=v,h[v]=v} }return""}function i(r,t){if(null==r)return"";var n,e,i,o,u,a,s,c,f="",l=0,h=2,p=3,v=2,d="",g=[],m=0,w=0;for(n=0;n<r.length;n+=1)w|=r[n]<<l,l+=8,8==l&&(g.push(w),w=0,l=0);for(n=0;n<g.length;n+=1){switch(e=g[n],o=e>>0&255,u=e>>8&255,a=e>>16&255,s=(e>>24&255)<<24|a<<16|u<<8|o,m=0;m<3;m+=1){switch(h){case 0:case 1:case 2:} } }return f}var o={},u=String.fromCharCode(0),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};s.compressToEncodedURIComponent=function(r){if(null==r)return"";var n,e,o,u,a,s,c,f=[],l=2,h=3,p=2,v=[],d=0,g=0,m=0;for(o=0;o<r.length;o+=1)if(n=r.charAt(o),Object.prototype.hasOwnProperty.call(s,n)||(s[n]=m++,c++),e=u+n,Object.prototype.hasOwnProperty.call(s,e))u=e;else{if(void 0!==s[u]){var w=s[u];for(n=0;n<p;n++)d<<=1,g==l-1?(g=0,f.push(d),d=0):g++,d|=w>>n&1}else for(w=u.charCodeAt(0),n=0;n<8;n++)d<<=1,g==l-1?(g=0,f.push(d),d=0):g++,d|=w>>n&1;s[e]=m++,u=String(n),0==--h&&(h=Math.pow(2,p),p++); }if(""!==u){if(void 0!==s[u])for(w=s[u],n=0;n<p;n++)d<<=1,g==l-1?(g=0,f.push(d),d=0):g++,d|=w>>n&1;else for(w=u.charCodeAt(0),n=0;n<8;n++)d<<=1,g==l-1?(g=0,f.push(d),d=0):g++,d|=w>>n&1}for(n=0;n<p;n++)d<<=1,g==l-1?(g=0,f.push(d),d=0):g++;for(n=0;n<g;n++)f.push(d<<n);var y="";for(n=0;n<f.length;n++)y+=a.charAt(f[n]);return y};s.decompressFromEncodedURIComponent=function(r){if(null==r)return"";for(var n="",e=0,i=0;i<r.length;i++){var o=a.indexOf(r.charAt(i));if(o<0)continue;e=e<<6|o,56==(i&7)&&(n+=String.fromCharCode(e&255),n+=String.fromCharCode(e>>8&255),n+=String.fromCharCode(e>>16&255),n+=String.fromCharCode(e>>24&255),e=0)}try{return decodeURIComponent(escape(n))}catch(u){return n}};window._LZ=s;}();

const $ = (id)=>document.getElementById(id);
const methodSel = $('method'), upiBox = $('upiBox'), ltcBox = $('ltcBox');

methodSel.addEventListener('change', ()=>{
  const m = methodSel.value;
  upiBox.classList.toggle('hidden', m!=='upi');
  ltcBox.classList.toggle('hidden', m!=='ltc');
});

function makePayload(){
  const m = methodSel.value;
  const base = {
    i: $('id').value.trim() || null,         // invoice id
    u: $('user').value.trim() || null,       // username
    n: $('notes').value.trim() || null,      // notes/instructions
    m,                                        // method: upi | ltc
    v: 1,                                     // schema version
    t: Date.now()
  };
  if (m==='upi') {
    base.ai = Number($('amt_inr').value || 0);  // amount INR
    base.p  = $('upi').value.trim();            // upi id
    if (!base.ai || !base.p) throw new Error('Enter INR amount and UPI ID.');
  } else {
    base.au = Number($('amt_usd').value || 0);  // amount USD (display)
    base.al = Number($('amt_ltc').value || 0);  // amount LTC (QR)
    base.l  = $('ltc').value.trim();            // LTC address
    if (!base.au || !base.al || !base.l) throw new Error('Enter USD amount, LTC amount, and LTC address.');
  }
  return base;
}

$('gen').addEventListener('click', ()=>{
  try{
    const payload = makePayload();
    const json = JSON.stringify(payload);
    const token = window._LZ.compressToEncodedURIComponent(json);
    const url = location.origin + location.pathname.replace(/create\.html$/,'') + 'pay.html#t=' + token;
    $('out').innerHTML = `
      <div><strong>Link:</strong> <a href="${url}" target="_blank" style="color:#fff;text-decoration:underline">${url}</a></div>
      <div style="margin-top:8px"><button id="copy">Copy link</button></div>`;
    $('copy').onclick = ()=>navigator.clipboard.writeText(url).then(()=>alert('Copied!')).catch(()=>alert('Copy failed'));
  }catch(e){
    alert(e.message || 'Please fill all required fields.');
  }
});
</script>
</body>
</html>
